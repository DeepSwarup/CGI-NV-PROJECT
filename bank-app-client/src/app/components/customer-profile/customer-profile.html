<div *ngIf="isLoading()" class="text-center py-4">
  <div class="spinner-border text-primary" role="status"></div>
</div>

<div *ngIf="!isLoading()">
  <!-- VIEW MODE -->
  <div *ngIf="profile() && !isEditMode()">
    <div class="profile-details">
      <div class="detail-item">
        <span class="detail-label">Phone Number</span>
        <span class="detail-value">{{ profile()?.phoneNo }}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">Age</span>
        <span class="detail-value">{{ profile()?.age }}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">Gender</span>
        <span class="detail-value">{{ profile()?.gender }}</span>
      </div>
    </div>
    <div class="mt-4 pt-3 border-top">
      <button class="btn btn-primary" (click)="startEdit()">Edit Profile</button>
      <button class="btn btn-outline-danger ms-2" (click)="showDeleteModal.set(true)">Delete Profile</button>
    </div>
  </div>

  <!-- EDIT / CREATE MODE -->
  <div *ngIf="isEditMode()">
    <h6 *ngIf="!profile()" class="text-muted mb-3">Please complete your profile to continue.</h6>
    <form [formGroup]="profileForm" (ngSubmit)="onSubmit()">
      <div class="row g-3">
        <div class="col-md-6">
          <label for="phoneNo" class="form-label">Phone Number</label>
          <input type="text" id="phoneNo" class="form-control" formControlName="phoneNo">
        </div>
        <div class="col-md-3">
          <label for="age" class="form-label">Age</label>
          <input type="number" id="age" class="form-control" formControlName="age">
        </div>
        <div class="col-md-3">
          <label for="gender" class="form-label">Gender</label>
          <select id="gender" class="form-select" formControlName="gender">
            <option value="" disabled>Select...</option>
            <option value="MALE">Male</option>
            <option value="FEMALE">Female</option>
            <option value="OTHER">Other</option>
          </select>
        </div>
      </div>
      <div class="mt-4 pt-3 border-top">
        <button type="submit" class="btn btn-success" [disabled]="profileForm.invalid">
          {{ profile() ? 'Save Changes' : 'Create Profile' }}
        </button>
        <button *ngIf="profile()" type="button" class="btn btn-secondary ms-2" (click)="cancelEdit()">Cancel</button>
      </div>
    </form>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div *ngIf="showDeleteModal()" class="modal fade show d-block" style="background-color: rgba(0,0,0,0.5);">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Confirm Deletion</h5>
        <button type="button" class="btn-close" (click)="showDeleteModal.set(false)"></button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete your profile? This action cannot be undone.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="showDeleteModal.set(false)">Cancel</button>
        <button type="button" class="btn btn-danger" (click)="onDelete()">Yes, Delete Profile</button>
      </div>
    </div>
  </div>
</div>

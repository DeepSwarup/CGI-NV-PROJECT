<div *ngIf="!isLoading()">
    <!-- Welcome Header -->
    <h1 class="mb-1">Welcome back, {{ userName() }}!</h1>
    
   
    <!-- Main Content Row -->
    <div class="row g-4">
        <!-- Main Column now takes full width -->
        <div class="col-lg-12">

            <!-- START: Repositioned Quick Actions Card -->
            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title mb-3">Quick Actions</h5>
                    <!-- This div now uses a responsive grid layout class -->
                    <div class="quick-actions-grid">
                        <button class="btn btn-light border text-start" (click)="openModal('transfer')"><i class="bi bi-send-fill me-2 text-primary"></i>Transfer Money</button>
                        <button class="btn btn-light border text-start" (click)="openModal('account')"><i class="bi bi-plus-circle-fill me-2 text-success"></i>Create New Account</button>
                        <button class="btn btn-light border text-start" (click)="navigate('/beneficiaries')"><i class="bi bi-person-plus-fill me-2 text-info"></i>Add Beneficiary</button>
                        <button class="btn btn-light border text-start" (click)="navigate('/nominees')"><i class="bi bi-person-badge-fill me-2 text-warning"></i>Add Nominee</button>
                    </div>
                </div>
            </div>
            <!-- END: Repositioned Quick Actions Card -->

            <div class="row g-4">
                <!-- Your Accounts Card -->
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-body">
                            <h5 class="card-title">Your Accounts</h5>
                            <p class="card-subtitle mb-3 text-muted">Summary of current accounts.</p>
                            <div *ngIf="accounts().length > 0; else noAccounts">
                                <div *ngFor="let acc of accounts()" class="account-item">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <div class="fw-bold d-flex align-items-center">
                                                {{ acc.accountType }} Account <span class="status-dot ms-2" [ngClass]="getAccountStatusClass(acc.status)"></span>
                                            </div>
                                            <div class="text-muted small">ID: {{ acc.accountId }}</div>
                                        </div>

                                        <div class="text-end">
                                            <div class="fw-bold">{{ acc.balance | currency:'INR' }}</div>
                                            <div class="text-muted small">{{ acc.interestRate }}% p.a.</div>
                                            <div *ngIf="acc.accountType === 'TERM'" class="text-muted small">Penalty: {{ acc.penaltyAmount | currency:'INR' }}</div>
    
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <ng-template #noAccounts><p class="text-muted fst-italic">No accounts created yet.</p></ng-template>
                        </div>
                    </div>
                </div>
                <!-- Recent Transactions Card -->
               <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-body">
                            <h5 class="card-title">Recent Transactions</h5>
                            <div *ngIf="recentTransactions().length > 0; else noTransactions">
                                <ul class="list-group list-group-flush transaction-list">
                                    <li *ngFor="let tx of recentTransactions()" class="list-group-item d-flex justify-content-between align-items-center">
                                        <div class="d-flex align-items-center">
                                            <div class="icon-circle me-3" [ngClass]="{'bg-success-light text-success': tx.transactiontype === 'DEPOSIT', 'bg-danger-light text-danger': tx.transactiontype !== 'DEPOSIT'}">
                                                <i class="bi" [ngClass]="{'bi-arrow-down': tx.transactiontype === 'DEPOSIT', 'bi-arrow-up': tx.transactiontype !== 'DEPOSIT'}"></i>
                                            </div>
                                            <div>
                                                <div class="fw-bold">{{ tx.transactionRemarks || 'Transaction' }}</div>
                                                <div class="small text-muted">
                                                    Acc #{{ tx.accountId }} Â· {{ tx.transactionDateandTime | date:'mediumDate' }}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="text-end">
                                            <div class="fw-bold" [ngClass]="{'text-success': tx.transactiontype === 'DEPOSIT', 'text-danger': tx.transactiontype !== 'DEPOSIT'}">
                                                {{ (tx.transactiontype === 'DEPOSIT' ? '+' : '-') + (tx.amount | currency:'INR') }}
                                            </div>
                                            <span class="badge" [ngClass]="tx.transactionstatus === 'SUCCESS' ? 'bg-success-light text-success' : 'bg-danger-light text-danger'">
                                                {{ tx.transactionstatus }}
                                            </span>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                             <ng-template #noTransactions><p class="text-muted fst-italic">No recent transactions to show.</p></ng-template>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- All modals remain unchanged at the bottom -->
<!-- Create Account Modal -->
<div *ngIf="showAccountModal()" class="modal fade show d-block" style="background-color: rgba(0,0,0,0.5);">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <form [formGroup]="accountForm" (ngSubmit)="createAccount()">
                <div class="modal-header">
                    <h5 class="modal-title">Create New Bank Account</h5>
                    <button type="button" class="btn-close" (click)="closeModal()"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Account Type</label>
                        <select formControlName="accountType" class="form-select">
                            <option value="SAVINGS">Savings</option>
                            <option value="TERM">Term (Fixed)</option>
                        </select>
                    </div>
                    
                    <!-- This field is now used for both Savings and Term initial deposits -->
                    <div class="mb-3">
                        <label class="form-label">Deposit Amount</label>
                        <input type="number" formControlName="initialDeposit" class="form-control">
                    </div>

                    <!-- Savings Fields -->
                    <div *ngIf="accountForm.get('accountType')?.value === 'SAVINGS'">
                        <div class="mb-3">
                            <label class="form-label">Minimum Balance</label>
                            <input type="number" formControlName="minBalance" class="form-control">
                        </div>
                    </div>

                    <!-- Term Fields -->
                    <div *ngIf="accountForm.get('accountType')?.value === 'TERM'">
                        <!-- REMOVED: The redundant "Term Amount" field is gone -->
                        <div class="mb-3">
                            <label class="form-label">Duration (Months)</label>
                            <input type="number" formControlName="months" class="form-control">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary" [disabled]="accountForm.invalid">Submit for Approval</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Transfer Money Modal -->
<div *ngIf="showTransferModal()" class="modal fade show d-block" style="background-color: rgba(0,0,0,0.5);">
    <div class="modal-dialog modal-dialog-centered"><div class="modal-content"><form [formGroup]="transferForm" (ngSubmit)="executeTransfer()"><div class="modal-header"><h5 class="modal-title">Transfer Money</h5><button type="button" class="btn-close" (click)="closeModal()"></button></div><div class="modal-body"><div *ngIf="transferError()" class="alert alert-danger">{{ transferError() }}</div><div class="mb-3"><label class="form-label">From Account</label><select formControlName="senderAccountId" class="form-select"><option value="" disabled>Select an account...</option><option *ngFor="let acc of accounts()" [value]="acc.accountId" [disabled]="acc.status !== 'ACTIVE'">{{ acc.accountType }} Account (#{{acc.accountId}}) - {{acc.balance | currency:'INR'}}</option></select></div><div class="mb-3"><label class="form-label">To Account / Beneficiary</label><select formControlName="receiverAccountId" class="form-select"><option value="" disabled>Select a destination...</option><option *ngFor="let target of transferTargets()" [value]="target.id">{{ target.name }}</option></select></div><div class="mb-3"><label class="form-label">Amount</label><input type="number" formControlName="amount" class="form-control" placeholder="0.00"></div><div class="mb-3"><label class="form-label">Remarks (Optional)</label><input type="text" formControlName="remarks" class="form-control" placeholder="e.g., Dinner payment"></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" (click)="closeModal()">Cancel</button><button type="submit" class="btn btn-primary" [disabled]="transferForm.invalid">Send Money</button></div></form></div></div>
</div>

